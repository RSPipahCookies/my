<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PipahCookies â€” Multi-Product Reseller Portal</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    /* Updated Soft Beige Theme */
    :root{
      --primary: #A67734; /* Rich Brown/Gold Accent */
      --primary-dark: #6C4920; /* Darker Brown for Text/Headers */
      --accent: #F4EAE0; /* Soft Beige/Cream Background */
      --whatsapp: #25d366;
      --sea-blue: #0ea5e9; /* New Sea Blue for highlight */
      --bg: #F9F7F5; /* Very Light Beige Background */
      --card: #ffffff;
      --muted: #888888;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:'Inter', sans-serif;background:var(--bg);color:#333;-webkit-font-smoothing:antialiased}
    h1,h2,h3{font-family:'Inter', sans-serif;color:var(--primary-dark);margin:0 0 12px;font-weight:700}
    a{color:inherit}

    .site-header{display:block}
    .header-img{width:100%;height:auto;display:block;object-fit:cover;max-height:300px;border-radius:0 0 18px 18px;box-shadow:0 12px 25px rgba(0,0,0,0.1);animation:fadeUp .9s both}
    .site-nav{position:sticky;top:0;background:var(--primary);z-index:1000;box-shadow:0 2px 4px rgba(0,0,0,0.1);padding:10px 0}
    .nav-list{display:flex;justify-content:space-around;max-width:1000px;margin:0 auto;list-style:none;padding:0}
    .nav-list a{text-decoration:none;color:var(--accent);padding:10px 15px;border-radius:6px;transition:background-color .2s;font-weight:600;}
    .nav-list a:hover{background-color:rgba(255,255,255,0.2)}

    .container{max-width:1200px;margin:0 auto;padding:0 20px}
    .section{padding:40px 0;border-bottom:1px solid rgba(0,0,0,0.08)}
    
    /* Responsive Product Grid (General Product List) */
    .products {
        display: grid;
        grid-template-columns: repeat(2, 1fr); 
        gap: 20px;
        justify-content: center;
    }
    @media (min-width: 768px) {
        .products {
            grid-template-columns: repeat(3, 1fr); 
        }
    }
    @media (min-width: 1024px) {
        .products {
            grid-template-columns: repeat(4, 1fr); 
        }
    }

    .card{background:var(--card);padding:20px;border-radius:12px;box-shadow:0 6px 15px rgba(0,0,0,0.05);transition:transform .3s;text-align:center;}
    .card:hover{transform:translateY(-3px);box-shadow:0 8px 18px rgba(0,0,0,0.1);}
    
    /* Specific Card for Generator */
    .generator-card {
        border: 2px solid #e0e0e0;
        position: relative;
    }
    .generator-card.selected {
        border-color: var(--sea-blue); 
        box-shadow: 0 0 15px rgba(14, 165, 233, 0.4); 
    }
    .card-checkbox {
        position: absolute;
        top: 6px; 
        right: 6px; 
        width: 20px; 
        height: 20px;
        cursor: pointer;
        z-index: 10;
        accent-color: var(--sea-blue); 
    }

    /* Grid container for 3-in-row layout */
    .generator-grid-3-in-row {
        display: grid;
        grid-template-columns: repeat(2, 1fr); /* 2 columns on small screens */
        gap: 15px; 
        padding: 10px 0;
    }
    @media (min-width: 640px) {
        .generator-grid-3-in-row {
            grid-template-columns: repeat(3, 1fr); /* 3 columns on medium screens */
        }
    }
    @media (min-width: 1024px) {
        .generator-grid-3-in-row {
            grid-template-columns: repeat(4, 1fr); /* 4 columns on desktop for better scaling */
        }
    }
    
    /* Compact Card Style for Generator Grid */
    .generator-card-grid {
        display: flex;
        flex-direction: column; 
        align-items: center;
        text-align: center;
        background: var(--card);
        border-radius: 10px; 
        box-shadow: 0 4px 10px rgba(0,0,0,0.05); 
        transition: transform .2s;
        height: 100%; 
        padding: 12px; 
    }
    .generator-card-grid:hover{transform:translateY(-2px);box-shadow:0 6px 12px rgba(0,0,0,0.1);}

    .generator-card-grid img {
        width: 55px !important; 
        height: 55px !important; 
        margin-bottom: 8px !important;
        margin-right: 0 !important;
        margin-top: 5px; 
    }
    
    .generator-card-grid .product-details {
        flex-grow: 1;
        min-height: 40px; 
        margin-bottom: 5px;
    }

    .generator-card-grid .input-group {
        margin-top: 5px; 
        width: 100%;
        margin-bottom: 0;
        text-align: center;
    }

    .generator-card-grid .product-details h4 {
        font-size: 0.9em; 
        margin-bottom: 2px;
    }

    .generator-card-grid .input-group input {
        text-align: center;
        padding: 4px !important; 
        font-size: 1em !important; 
        font-weight: 700;
    }
    
    .generator-card-grid .input-group label {
        font-size: 0.7em; 
        font-weight: 500;
        color: var(--muted);
    }

    .generator-card-grid.selected {
        border-width: 3px; 
    }

    
    /* Tier Product Button Style */
    .tier-product-btn {
        display: block;
        padding: 20px 10px;
        background: #fdfdfd;
        border-radius: 10px;
        border: 2px solid var(--accent);
        box-shadow: 0 10px 20px rgba(0,0,0,0.05);
        transition: all 0.2s;
        transform: perspective(1px) translateZ(0);
    }
    .tier-product-btn:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 25px rgba(0,0,0,0.1);
        border-color: var(--primary);
    }
    .tier-product-btn img {
        width: 60px;
        height: 60px;
        margin-bottom: 8px;
    }
    .tier-product-btn h4 {
        font-size: 1em;
        font-weight: 700;
        margin-bottom: 0;
    }
    

    .btn{display:inline-block;padding:12px 25px;border-radius:8px;text-decoration:none;font-weight:600;transition:all .2s;text-align:center;border:none;}
    .primary-btn{background:var(--primary);color:#fff}
    .secondary-btn{background:var(--primary-dark);color:#fff}
    .whatsapp-btn{background:var(--whatsapp);color:#fff}
    .input-group{margin-bottom:15px}
    .input-group label{display:block;margin-bottom:5px;font-weight:600;color:var(--primary-dark);font-size:0.95em;}
    .input-group input, .input-group select{width:100%;padding:10px;border:1px solid #ddd;border-radius:6px;font-size:1em;color:#444}
    
    /* Profit Calculator FAB Styles */
    .fab-container{position:fixed;bottom:20px;right:20px;z-index:1001}
    .fab-btn{background:var(--primary);color:#fff;border:none;border-radius:50%;width:56px;height:56px;font-size:1.5em;cursor:pointer;box-shadow:0 4px 10px rgba(0,0,0,0.2);display:flex;align-items:center;justify-content:center;transition:background-color .2s}
    .fab-btn:hover{background-color:var(--primary-dark)}
    .calculator-modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:1002;align-items:center;justify-content:center}
    .calculator-content{background:var(--card);padding:30px;border-radius:16px;box-shadow:0 8px 30px rgba(0,0,0,0.3);width:90%;max-width:400px;transform:translateY(20px);opacity:0;transition:all .3s ease-out}
    .calculator-modal.open .calculator-content{transform:translateY(0);opacity:1}
    .profit-result span{font-size:1.8em;font-weight:700;color:var(--whatsapp);display:block;margin-top:5px;}
  </style>
</head>
<body>

  <header class="site-header">
    <img id="header-banner" src="images/Header2.jpg" alt="Header Image" class="header-img">
  </header>

  <nav class="site-nav">
    <ul class="nav-list">
      <li><a href="#products">Produk & Tiers</a></li>
      <li><a href="#generator">Jana Jualan</a></li>
      <li><a href="#contact">Hubungi Kami</a></li>
    </ul>
  </nav>

  <div class="container">

    <section id="products" class="section">
      <h2 class="text-center text-3xl mb-8">Senarai Produk & Harga Runcit Disyorkan (RRP)</h2>
      <p class="text-center text-gray-500 mb-6 text-sm">Klik pada produk untuk melihat struktur tiers harga reseller (kos anda).</p>
      <div id="product-list" class="products">
        </div>
    </section>
    
    <div id="tierModal" class="calculator-modal" onclick="closeModal(event)">
        <div class="calculator-content" onclick="event.stopPropagation()" style="max-width: 500px;">
            <h3 class="text-center text-2xl mb-5" id="tierModalTitle">Struktur Tiers Harga: -</h3>

            <div id="product-tiers-list" class="my-4">
                </div>
            
            <p class="text-sm text-gray-700 mt-5">Sila gunakan Kalkulator Keuntungan untuk mengira kos sebenar anda.</p>

            <button class="close-btn" onclick="closeTierModal()" style="position:absolute;top:10px;right:10px;background:none;border:none;font-size:1.5em;color:var(--muted);"><i class="fas fa-times"></i></button>
        </div>
    </div>
    <section id="generator" class="section bg-accent p-8 rounded-2xl shadow-xl">
      <h2 class="text-center text-3xl" style="color:var(--whatsapp);"><i class="fas fa-share-alt"></i> Jana Pautan Jualan Anda</h2>
      <p class="text-center text-gray-600 mb-8">
        1. Pilih produk, 2. Tetapkan harga runcit anda, 3. Jana pautan.
      </p>

      <div class="max-w-4xl mx-auto">
        <div class="input-group">
          <label for="whatsappNumber">Nombor WhatsApp Anda (e.g. 60123456789)</label>
          <input type="tel" id="whatsappNumber" placeholder="Sila masukkan nombor WhatsApp penuh" value="60123456789" class="shadow-sm">
        </div>

        <hr class="my-6 border-primary/20">
        
        <h3 class="text-xl font-semibold text-center mb-4 text-primary-dark">Pilih Produk & Tetapkan Harga Jualan Runcit (RM)</h3>
        
        <div id="generator-product-grid" class="generator-grid-3-in-row">
            </div>

        <div class="text-center my-8">
          <button onclick="generateLink()" class="btn whatsapp-btn text-lg w-full py-4 shadow-lg hover:shadow-xl">
            <i class="fas fa-link"></i> Jana & Salin Pautan Jualan Sekarang
          </button>
        </div>

        <div id="generatedLinkContainer" class="hidden mt-6 bg-white p-5 rounded-lg border-l-4 border-whatsapp shadow-inner">
          <p class="font-bold text-green-700 mb-3 text-center">Pautan Jualan Anda Berjaya Dijana & Disalin! (index.html-...)</p>
          <input type="text" id="salesLink" readonly class="w-full p-3 border-dashed border-gray-400 rounded-md text-sm text-center cursor-pointer bg-gray-50" onclick="copyLink()">
          <a id="testLink" href="#" target="_blank" class="block mt-4 text-center text-sm text-primary hover:underline font-medium">Cuba Pautan Ini Dalam Tab Baru <i class="fas fa-external-link-alt"></i></a>
        </div>
      </div>
    </section>
    <section id="contact" class="section">
      <h2 class="text-center text-3xl">ðŸ”§</h2>
      <p class="text-center text-gray-600 mb-6">Jika anda memerlukan bantuan, bertanya tentang stok, atau menghadapi isu teknikal.</p>
      <div class="text-center">
        <a id="hq-whatsapp-link" href="#" class="btn whatsapp-btn text-lg shadow-md" target="_blank">
          <i class="fab fa-whatsapp"></i> klik for Support
        </a>
      </div>
    </section>

  </div>

  <div class="fab-container">
    <button class="fab-btn shadow-xl" onclick="toggleCalculator()">
      <i class="fas fa-calculator"></i>
    </button>
  </div>

  <div id="calculatorModal" class="calculator-modal" onclick="closeModal(event)">
    <div class="calculator-content" onclick="event.stopPropagation()">
      <h3 class="text-center text-2xl mb-5">Kalkulator Keuntungan Reseller</h3>

      <div class="input-group">
        <label for="calcProduct">Pilih Produk</label>
        <select id="calcProduct" onchange="calculateProfit()">
          </select>
      </div>

      <div class="input-group">
        <label for="calcRetailPrice">Harga Jualan Runcit Anda (RM)</label>
        <input type="number" id="calcRetailPrice" step="0.50" min="1" value="25.00" oninput="calculateProfit()" class="text-xl font-bold text-primary-dark">
      </div>

      <div class="input-group">
        <label for="calcQuantity">Kuantiti (Unit)</label>
        <input type="number" id="calcQuantity" min="1" value="10" oninput="calculateProfit()">
      </div>
      
      <div class="my-5 p-5 rounded-xl border-2 border-primary-dark bg-accent/70">
        <p class="text-sm text-gray-700 mb-3">Kos Reseller Per Unit (Tier Diskaun: <strong id="calcDiscountTierName">-</strong>): <strong id="calcCostPerUnit">RM 0.00</strong></p>
        <p class="text-xl font-semibold text-primary-dark">Keuntungan Kasar Total:</p>
        <div class="profit-result">
            <span id="calcProfit">RM 0.00</span>
        </div>
      </div>
      <button class="close-btn" onclick="toggleCalculator()" style="position:absolute;top:10px;right:10px;background:none;border:none;font-size:1.5em;color:var(--muted);"><i class="fas fa-times"></i></button>
    </div>
  </div>
  
  <script src="pipah-product-config.js"></script>
  
  <script>
   
   // --- UI SETUP ---
   document.addEventListener('DOMContentLoaded', () => {
     // Set the header image source using the config variable
     document.getElementById('header-banner').src = window.HEADER_IMAGE_URL; 
     document.getElementById('hq-whatsapp-link').href = `https://wa.me/${window.HQ_WHATSAPP_NUMBER}`;
     
     loadProductList();
     // loadTierProductButtons(); <--- DIKELUARKAN
     loadGeneratorGrid(); 
     loadCalculatorOptions();
     calculateProfit(); 
   });

   // Loads product cards (for info section)
   function loadProductList() {
     const container = document.getElementById('product-list');
     // Menggunakan window.PRODUCTS_DATA dari fail config
     container.innerHTML = window.PRODUCTS_DATA.map(p => `
       <div class="card flex flex-col items-center cursor-pointer" onclick="openTierModal('${p.id}')">
         <img src="${p.img_url}" onerror="this.onerror=null; this.src='https://placehold.co/100x100/A67734/ffffff?text=Product';" class="w-24 h-24 object-cover rounded-full mb-4 shadow-md border-2 border-accent" alt="${p.name}">
         <h3 class="text-lg text-center">${p.name}</h3>
         <p class="text-sm text-gray-700">RRP: <strong style="color:var(--primary); font-size:1.1em;">RM ${p.rrp.toFixed(2)}</strong></p>
         <p class="text-xs mt-2 text-gray-500">Kos Minima: RM ${window.getResellerCost(p.id, 100).cost.toFixed(2)}</p>
       </div>
     `).join('');
   }

   // loadTierProductButtons() <--- DIKELUARKAN
   
   // Opens the Tier Modal
   function openTierModal(productId) {
       const modal = document.getElementById('tierModal');
       const title = document.getElementById('tierModalTitle');
       const listContainer = document.getElementById('product-tiers-list');
       const product = window.PRODUCTS_DATA.find(p => p.id === productId);

       if (!product) return;

       title.textContent = `Struktur Tiers Harga: ${product.name}`;
       
       listContainer.innerHTML = product.tiers.map(t => `
           <div class="flex justify-between items-center p-3 my-2 rounded-lg ${t.max === Infinity ? 'bg-green-100 border-l-4 border-green-500' : 'bg-white border'}">
               <div>
                   <span class="font-bold text-primary-dark">${t.name}</span>
                   <p class="text-xs text-gray-500">${t.min} - ${t.max === Infinity ? 'Infinity' : t.max} unit</p>
               </div>
               <span class="text-xl font-bold text-whatsapp">RM ${t.price.toFixed(2)}</span>
           </div>
       `).join('');
       
       modal.classList.add('open');
       modal.style.display = 'flex';
   }
   
   function closeTierModal() {
       const modal = document.getElementById('tierModal');
       modal.classList.remove('open');
       setTimeout(() => modal.style.display = 'none', 300);
   }

   // Loads the combined product selection and price setting grid (COMPACT)
   function loadGeneratorGrid() {
     const container = document.getElementById('generator-product-grid');
     // Menggunakan window.PRODUCTS_DATA dari fail config
     container.innerHTML = window.PRODUCTS_DATA.map((p, index) => `
       <div id="card_${p.id}" class="generator-card generator-card-grid ${index < 3 ? 'selected' : ''}">
           <input type="checkbox" id="check_${p.id}" value="${p.id}" ${index < 3 ? 'checked' : ''} class="card-checkbox" onchange="toggleCardSelection('${p.id}')">
           
<img src="${p.img_url}" onerror="this.onerror=null; this.src='https://placehold.co/60x60/A67734/ffffff?text=IMG';" class="w-14 h-14 object-cover rounded-full shadow-md border-2 border-accent" alt="${p.name}">
           
           <div class="product-details">
                <h4 class="font-semibold">${p.name}</h4>
                <p class="text-xs text-gray-500">RRP: RM ${p.rrp.toFixed(2)}</p>
           </div>

           <div class="input-group">
               <label for="price_${p.id}" class="">Harga Jual (RM)</label>
               <input type="number" id="price_${p.id}" step="0.50" min="1" value="${p.rrp.toFixed(2)}" class="w-full">
           </div>
       </div>
     `).join('');
   }

   function toggleCardSelection(productId) {
       const card = document.getElementById(`card_${productId}`);
       const checkbox = document.getElementById(`check_${productId}`);
       if (checkbox.checked) {
           card.classList.add('selected');
       } else {
           card.classList.remove('selected');
       }
   }
   
   // --- SALES LINK GENERATOR LOGIC (Unchanged) ---
   function generateLink() {
     const whatsapp = document.getElementById('whatsappNumber').value.trim();
     const linkContainer = document.getElementById('generatedLinkContainer');
     const salesLinkInput = document.getElementById('salesLink');
     const testLink = document.getElementById('testLink');
     
     if (!whatsapp || whatsapp.length < 8) {
       showTemporaryAlert('âŒ Ralat: Sila masukkan Nombor WhatsApp yang sah.', 'bg-red-500');
       return;
     }

     let selectedIds = [];
     let selectedPrices = [];

     // Menggunakan window.PRODUCTS_DATA dari fail config
     window.PRODUCTS_DATA.forEach(p => {
       const checkbox = document.getElementById(`check_${p.id}`);
       if (checkbox && checkbox.checked) {
           const priceInput = document.getElementById(`price_${p.id}`);
           let price = parseFloat(priceInput.value);
           
           if (isNaN(price) || price < 0.01) {
             price = p.rrp; // Use RRP as fallback if price is invalid
           }
           
           selectedIds.push(p.id);
           selectedPrices.push(price.toFixed(2)); // Ensure price is formatted correctly
       }
     });
     
     if (selectedIds.length === 0) {
         showTemporaryAlert('âŒ Ralat: Sila pilih sekurang-kurangnya satu produk.', 'bg-red-500');
         return;
     }
        // FORMAT PENTING BARU: rs_wa, p_ids, p_prices 
     const params = `rs_wa=${whatsapp}&p_ids=${selectedIds.join(',')}&p_prices=${selectedPrices.join(',')}`;
const customerFormFile = 'OrderNow.html'; // Pautan ke borang pesanan pelanggan
     
     
     const fullLink = `${customerFormFile}?${params}`;
       const displayLink = `OrderNow.html-...?rs_wa=${whatsapp}`; 
     // Construct the full absolute URL for the customer file
     const baseUrl = window.location.href.substring(0, window.location.href.lastIndexOf('/') + 1);
     const fullUrl = `${baseUrl}${fullLink}`;

     // Save Reseller WA and Prices to Local Storage (Fallback for Customer Portal)
     localStorage.setItem('loggedInResellerWa', whatsapp);
     
     const priceMap = {};
     selectedIds.forEach((id, index) => {
         priceMap[id] = parseFloat(selectedPrices[index]);
     });
     localStorage.setItem('currentResellerPrices', JSON.stringify(priceMap));

     salesLinkInput.value = displayLink;
     testLink.href = fullUrl;
     linkContainer.classList.remove('hidden');

           // Copy to clipboard
     copyLink(fullUrl);
   }

   function copyLink(linkToCopy) {
     const tempInput = document.createElement('input');
     tempInput.value = linkToCopy;
     document.body.appendChild(tempInput);
     tempInput.select();
     tempInput.setSelectionRange(0, 99999); 
     
     let copied = false;
     try {
       copied = document.execCommand('copy');
     } catch (err) {
       console.error('Could not copy text: ', err);
     } finally {
       document.body.removeChild(tempInput);
     }
     
     if (copied) {
       const container = document.getElementById('generatedLinkContainer');
       const pElement = container.querySelector('p');
       pElement.textContent = 'Pautan telah disalin ke papan keratan! âœ…';
       setTimeout(() => {
         pElement.textContent = 'Pautan Jualan Anda Berjaya Dijana & Disalin!-...)'; // DIKEMASKINI
       }, 3000);
     } else {
       showTemporaryAlert('âŒ Gagal menyalin. Sila salin manual.', 'bg-red-500');
     }
   }

   function showTemporaryAlert(message, className) {
       const tempAlert = document.createElement('div');
       tempAlert.className = `fixed inset-0 ${className} text-white flex items-center justify-center p-4 z-50 text-xl font-bold`;
       tempAlert.textContent = message;
       document.body.appendChild(tempAlert);
       setTimeout(() => document.body.removeChild(tempAlert), 3000);
   }

   
   // --- PROFIT CALCULATOR LOGIC (Unchanged) ---
   function loadCalculatorOptions() {
       const select = document.getElementById('calcProduct');
       // Menggunakan window.PRODUCTS_DATA dari fail config
       select.innerHTML = window.PRODUCTS_DATA.map(p => 
           `<option value="${p.id}">${p.name} (RRP: RM ${p.rrp.toFixed(2)})</option>`
       ).join('');
       // Set initial RRP on load
       document.getElementById('calcRetailPrice').value = window.PRODUCTS_DATA[0].rrp.toFixed(2);
   }

   function calculateProfit() {
       const productId = document.getElementById('calcProduct').value;
       const retailPrice = parseFloat(document.getElementById('calcRetailPrice').value);
       const quantity = parseInt(document.getElementById('calcQuantity').value);
       
       const product = window.PRODUCTS_DATA.find(p => p.id === productId);

       if (!product || isNaN(retailPrice) || isNaN(quantity) || quantity < 1 || retailPrice < 1) {
           document.getElementById('calcProfit').textContent = 'RM 0.00';
           document.getElementById('calcCostPerUnit').textContent = 'RM 0.00';
           document.getElementById('calcDiscountTierName').textContent = '-';
           return;
       }

       // Menggunakan fungsi global
       const { cost: costPerUnit, name: discountName } = window.getResellerCost(productId, quantity);
       
       const profit = (retailPrice - costPerUnit) * quantity;
       
       document.getElementById('calcCostPerUnit').textContent = `RM ${costPerUnit.toFixed(2)}`;
       document.getElementById('calcDiscountTierName').textContent = discountName;
       document.getElementById('calcProfit').textContent = `RM ${profit.toFixed(2)}`;
   }

   function toggleCalculator() {
       const modal = document.getElementById('calculatorModal');
       modal.classList.toggle('open');
       if (modal.classList.contains('open')) {
           modal.style.display = 'flex';
           calculateProfit(); 
       } else {
           setTimeout(() => modal.style.display = 'none', 300);
       }
   }

   function closeModal(event) {
       if (event.target.id === 'calculatorModal') {
           toggleCalculator();
       }
       if (event.target.id === 'tierModal') {
           closeTierModal();
       }
   }
  </script>
</body>
</html>
