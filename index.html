<!doctype html>
<html lang="ms">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
  <title>Reseller Portal</title>
  
  <link rel="manifest" href="reseller-manifest.json">
  <link rel="apple-touch-icon" href="rs194.png">
  <meta name="theme-color" content="#0f172a">

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;700;800&display=swap" rel="stylesheet">
  
  <style>
    body{ font-family: 'Plus Jakarta Sans', sans-serif; background:#F8FAFC; padding-bottom: 90px; }
    .header-bg { background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); border-radius: 0 0 24px 24px; padding: 20px 20px 80px 20px; color: white; }
    .menu-card { background: white; padding: 12px; border-radius: 16px; border: 1px solid #e2e8f0; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05); display: flex; flex-direction: column; align-items: center; text-align: center; gap: 8px; height: 100%; justify-content: center; }
    .fab-cart { position: fixed; bottom: 25px; right: 25px; background: #0f172a; color: white; width: 56px; height: 56px; border-radius: 50%; display: grid; place-items: center; z-index: 40; cursor: pointer; box-shadow: 0 10px 20px rgba(0,0,0,0.2); transition: transform 0.2s; }
    .fab-cart:active { transform: scale(0.9); }
  </style>
</head>
<body>

  <div class="header-bg relative">
    <div class="flex justify-between items-start mb-4">
        <div>
            <p class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-1" data-i18n="subtitle">Reseller Portal</p>
            <h1 class="text-2xl font-extrabold">PipahCookies</h1>
        </div>
        <div class="bg-white/10 p-1 rounded-full flex">
            <button onclick="setLang('ms')" id="btn-ms" class="px-3 py-1 bg-white text-slate-900 rounded-full text-[10px] font-bold transition">MY</button>
            <button onclick="setLang('en')" id="btn-en" class="px-3 py-1 text-white/70 hover:bg-white/10 rounded-full text-[10px] font-bold transition">EN</button>
        </div>
    </div>
    
    <div class="grid grid-cols-3 gap-2 absolute left-4 right-4 -bottom-12">
        <a href="#shop" class="menu-card ring-2 ring-orange-100 ring-offset-2">
            <div class="w-8 h-8 rounded-full bg-orange-100 text-orange-600 grid place-items-center"><i class="fa-solid fa-boxes-stacked text-sm"></i></div>
            <div>
                <h3 class="font-bold text-xs text-slate-800" data-i18n="menu_stock">Beli Stok</h3>
                <p class="text-[9px] text-slate-500 leading-tight" data-i18n="desc_stock">Restock</p>
            </div>
        </a>
        <a href="RSDashboard.html" class="menu-card bg-slate-900 border-slate-900">
            <div class="w-8 h-8 rounded-full bg-slate-700 text-white grid place-items-center"><i class="fa-solid fa-rocket text-sm"></i></div>
            <div>
                <h3 class="font-bold text-xs text-white">Dropship</h3>
                <p class="text-[9px] text-gray-400 leading-tight" data-i18n="desc_link">Bina Link</p>
            </div>
        </a>
        <a href="gambar2reseller.html" class="menu-card">
            <div class="w-8 h-8 rounded-full bg-pink-100 text-pink-600 grid place-items-center"><i class="fa-regular fa-images text-sm"></i></div>
            <div>
                <h3 class="font-bold text-xs text-slate-800" data-i18n="menu_gallery">Galeri</h3>
                <p class="text-[9px] text-slate-500 leading-tight" data-i18n="desc_gallery">Bahan Iklan</p>
            </div>
        </a>
    </div>
  </div>

  <div class="max-w-md mx-auto px-4 mt-20" id="shop">
    <div class="flex justify-between items-center mb-4">
        <h2 class="font-bold text-slate-800" data-i18n="stock_list">Senarai Stok</h2>
        <button onclick="showInfo()" class="text-xs font-bold text-blue-600 flex items-center gap-1"><i class="fa-regular fa-circle-question"></i> <span data-i18n="info_price">Info Harga</span></button>
    </div>

    <div class="relative mb-6">
        <i class="fa-solid fa-magnifying-glass absolute left-4 top-3.5 text-gray-400"></i>
        <input type="text" id="search" onkeyup="renderProducts()" class="w-full pl-10 pr-4 py-3 bg-white border border-slate-200 rounded-xl text-sm font-semibold outline-none focus:ring-2 ring-orange-500 transition" placeholder="Cari produk...">
    </div>

    <div id="loading" class="text-center py-10">
        <div class="animate-spin w-6 h-6 border-2 border-slate-300 border-t-slate-800 rounded-full mx-auto mb-2"></div>
        <p class="text-xs text-slate-400">Loading...</p>
    </div>
    
    <div class="grid grid-cols-2 gap-4" id="product-grid"></div>
  </div>

  <div class="fab-cart" onclick="window.location.href='reseller-checkout.html'">
    <i class="fa-solid fa-cart-shopping"></i>
    <span class="absolute -top-1 -right-1 bg-red-500 text-white text-[10px] font-bold w-5 h-5 rounded-full grid place-items-center border-2 border-slate-50" id="cart-count">0</span>
  </div>

  <div class="fixed inset-0 bg-black/60 z-50 hidden items-center justify-center p-4 backdrop-blur-sm" id="modal" onclick="closeModal(event)">
      <div class="bg-white w-full max-w-sm rounded-2xl overflow-hidden animate-bounce-in shadow-2xl">
          <div class="relative">
              <img id="m-img" src="" class="w-full h-56 object-cover bg-slate-100">
              <button onclick="closeModal({target:{id:'modal'}})" class="absolute top-3 right-3 w-8 h-8 bg-black/30 text-white rounded-full backdrop-blur"><i class="fa-solid fa-times"></i></button>
          </div>
          <div class="p-5">
              <h2 id="m-title" class="text-xl font-bold text-slate-800 mb-1"></h2>
              <p id="m-price" class="text-lg font-extrabold text-blue-600 mb-3"></p>
              <div class="bg-slate-50 p-3 rounded-xl mb-4 border border-slate-100">
                  <p class="text-[10px] font-bold text-slate-400 uppercase mb-1" data-i18n="info_prod">Info Produk</p>
                  <p id="m-desc" class="text-xs text-slate-600 leading-relaxed"></p>
              </div>
              <button id="m-btn" class="w-full bg-slate-900 text-white font-bold py-3.5 rounded-xl shadow-lg active:scale-95 transition" data-i18n="add_cart">Tambah ke Cart</button>
          </div>
      </div>
  </div>

  <script>
    const firebaseConfig = { apiKey: "AIzaSyA2Y2cOh3J7U916Ip0tnDDFVs2fK6sACl0", authDomain: "pipahcookies-21e38.firebaseapp.com", projectId: "pipahcookies-21e38", storageBucket: "pipahcookies-21e38.firebasestorage.app", messagingSenderId: "162482379926", appId: "1:162482379926:web:14d16f5a2444816876f6b7" };
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    db.enablePersistence().catch(err => { console.log("Offline mode error:", err.code); });

    // --- I18N CONFIG ---
    let curLang = 'ms';
    const i18n = {
        ms: {
            subtitle:"Portal Reseller", menu_stock:"Beli Stok", desc_stock:"Restock", desc_link:"Bina Link",
            menu_gallery:"Galeri", desc_gallery:"Bahan Iklan", stock_list:"Senarai Stok", info_price:"Info Harga",
            ph_search:"Cari produk...", info_prod:"Info Produk", add_cart:"Tambah ke Cart",
            agent_price:"Harga Ejen", min_buy:"Min Beli", unit:"unit", alert_info:"Beli minimum kuantiti untuk dapat Harga Ejen (Tier 2)."
        },
        en: {
            subtitle:"Reseller Portal", menu_stock:"Buy Stock", desc_stock:"Restock", desc_link:"Build Link",
            menu_gallery:"Gallery", desc_gallery:"Marketing Ads", stock_list:"Stock List", info_price:"Price Info",
            ph_search:"Search products...", info_prod:"Product Info", add_cart:"Add to Cart",
            agent_price:"Agent Price", min_buy:"Min Buy", unit:"units", alert_info:"Buy minimum quantity to get Agent Price (Tier 2)."
        }
    };

    window.setLang = (l) => {
        curLang = l;
        document.getElementById('btn-ms').className = l==='ms' ? "px-3 py-1 bg-white text-slate-900 rounded-full text-[10px] font-bold transition" : "px-3 py-1 text-white/70 hover:bg-white/10 rounded-full text-[10px] font-bold transition";
        document.getElementById('btn-en').className = l==='en' ? "px-3 py-1 bg-white text-slate-900 rounded-full text-[10px] font-bold transition" : "px-3 py-1 text-white/70 hover:bg-white/10 rounded-full text-[10px] font-bold transition";
        
        document.querySelectorAll('[data-i18n]').forEach(e => e.innerText = i18n[l][e.dataset.i18n]);
        document.getElementById('search').placeholder = i18n[l].ph_search;
        renderProducts(); // Re-render to translate badges
    }

    window.showInfo = () => alert(i18n[curLang].alert_info);

    // --- MAIN LOGIC ---
    let PRODUCTS = [], CART = JSON.parse(localStorage.getItem('pipah_reseller_cart_v1') || '[]');
    updateCart();

    db.collection('products').where('available', '==', true).onSnapshot(snap => {
        document.getElementById('loading').style.display = 'none'; PRODUCTS = [];
        snap.forEach(doc => PRODUCTS.push({id:doc.id, ...doc.data()}));
        renderProducts();
    });

    function renderProducts() {
        const grid = document.getElementById('product-grid'); grid.innerHTML = '';
        const term = document.getElementById('search').value.toLowerCase();
        
        PRODUCTS.forEach(p => {
            if(p.name.toLowerCase().includes(term)) {
                let tierBadge = '';
                if(p.minQty2 && p.priceTier2) {
                    tierBadge = `
                    <div class="mt-2 flex flex-wrap gap-1">
                        <span class="bg-blue-50 text-blue-700 border border-blue-100 px-1.5 py-0.5 rounded text-[9px] font-bold">RM${p.priceTier2} (${i18n[curLang].agent_price})</span>
                        <span class="bg-slate-100 text-slate-500 border border-slate-200 px-1.5 py-0.5 rounded text-[9px]">${i18n[curLang].min_buy} ${p.minQty2}</span>
                    </div>`;
                }
                grid.innerHTML += `
                <div class="bg-white rounded-xl border border-slate-100 shadow-sm overflow-hidden flex flex-col h-full hover:border-orange-200 transition">
                    <img src="${p.image}" class="w-full h-36 object-cover bg-slate-50" onclick="openModal('${p.id}')">
                    <div class="p-3 flex flex-col flex-1">
                        <h3 class="font-bold text-xs text-slate-800 leading-snug line-clamp-2">${p.name}</h3>
                        ${tierBadge}
                        <div class="mt-auto flex items-center justify-between pt-3 border-t border-slate-50 mt-2">
                            <span class="font-extrabold text-sm text-slate-700">RM${(p.priceTier1||p.price).toFixed(0)}</span>
                            <button onclick="addToCart('${p.id}')" class="bg-slate-900 hover:bg-slate-800 text-white w-8 h-8 rounded-lg grid place-items-center transition active:scale-90"><i class="fa-solid fa-plus text-xs"></i></button>
                        </div>
                    </div>
                </div>`;
            }
        });
    }

    // Modal & Cart
    window.openModal = (id) => {
        const p = PRODUCTS.find(x=>x.id===id);
        document.getElementById('m-img').src = p.image;
        document.getElementById('m-title').innerText = p.name;
        document.getElementById('m-price').innerText = `RM ${(p.priceTier1||p.price).toFixed(2)}`;
        document.getElementById('m-desc').innerText = p.description || (curLang==='ms'?"Tiada deskripsi.":"No description.");
        document.getElementById('m-btn').innerText = i18n[curLang].add_cart;
        document.getElementById('m-btn').onclick = () => { addToCart(id); closeModal({target:{id:'modal'}}); };
        document.getElementById('modal').style.display = 'flex';
    };
    window.closeModal = (e) => { if(e.target.id==='modal') document.getElementById('modal').style.display = 'none'; };
    function addToCart(id) {
        const exist = CART.find(c=>c.id===id); if(exist) exist.qty++; else CART.push({id, qty:1});
        localStorage.setItem('pipah_reseller_cart_v1', JSON.stringify(CART)); updateCart();
        const btn = document.querySelector('.fab-cart'); btn.style.transform = "scale(1.2)"; setTimeout(()=>btn.style.transform="scale(1)", 150);
    }
    function updateCart() { document.getElementById('cart-count').innerText = CART.reduce((a,b)=>a+b.qty,0); }
    if ('serviceWorker' in navigator) window.addEventListener('load', () => navigator.serviceWorker.register('./service-worker.js'));
  </script>
</body>
</html>
